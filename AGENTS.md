# AGENTS.md

## Цель
Вы — облачный код-агент. Репозиторий: `local-clips-runner`. Задачи:
1) локально воспроизвести проект (dev-окружение),  
2) запустить тесты/линтеры,  
3) править баги и предлагать улучшения,  
4) отдавать результат PR’ом с понятным описанием.

## Как понимать структуру
1. Сначала определите тип проекта:
   - Если есть `pyproject.toml` или `requirements.txt` → **Python**.
   - Если есть `package.json` → **Node.js**.
   - Если монорепо — ищите внутренние `pyproject.toml` / `package.json` и работайте в соответствующем пакете.
2. Всегда печатайте обнаруженную структуру (дерево корня на 2–3 уровня), чтобы человеку было видно контекст.

## Подготовка окружения

### Python
- Версия: 3.11+ (если найден `.python-version` или в `pyproject.toml` указана иная — следуйте ей).
- Зависимости:
  - Если установлен `uv`: `uv sync` (предпочтительно).
  - Иначе: `python -m venv .venv && source .venv/bin/activate && pip install -U pip && pip install -r requirements.txt`  
    или `pip install .` если есть `pyproject.toml`.
- Запуск/скрипты:
  - Тесты: сначала попробуй `pytest -q`, иначе `python -m pytest -q`.
  - Линт/стиль: если есть, то `ruff check .` и `mypy .`.
  - Форматирование: `ruff format .` или `black .` (если `pyproject`/`ruff.toml`/`pyproject[tool.black]` присутствуют).

### Node.js
- Менеджер пакетов:
  - Если есть `pnpm-lock.yaml` → `pnpm i`.
  - Иначе `npm ci`.
- Скрипты (через `package.json`):
  - Тесты: `npm test` / `pnpm test` (если нет — пропустите с пометкой).
  - Линт: `npm run lint` / `pnpm lint`, если определён.
  - Dev/Build: используйте `dev`/`build`, если есть.

### Переменные окружения
- Не создавайте реальные секреты. Если проект требует, читайте `.env.example`/`README`.  
- Для локального прогона используйте `.env.local` (НЕ коммитить).  
- Никогда не добавляйте ключи/токены в git.

## Стратегия отладки
1. Воспроизведите проблему: `run`, `test`, `lint`. Сохраните логи.
2. Локализуйте дефект (минимальный репро).
3. Починка в малых PR:
   - Исправления + тесты, покрывающие кейс.
   - Обновите документацию, если меняется поведение.
4. Перед коммитом выполняйте:
   - Python: `ruff check . && pytest -q` (и `mypy .`, если есть типы).
   - Node: `npm run lint && npm test` (или pnpm-аналоги).

## Стиль и PR-правила
- Коммиты: Conventional Commits (`feat:`, `fix:`, `chore:` …).
- Заголовок PR: `[fix] кратко что починили` / `[feat] ...`.
- Описание PR: проблема → решение → риски → как протестировать (команды).
- Не меняйте форматирование «ради форматирования» — только если это часть фикса.

## Безопасность и ограничения
- Не трогайте CI/CD секреты, не меняйте `release`-процессы без явной задачи.
- Не добавляйте зависимости без нужды; если добавили — объясните выбор и влияние на размер/безопасность.
- Не выносите чувствительные пути/URL в код — используйте ENV.

## Проверка перед PR
1) Тесты и линтеры зелёные.  
2) Нет «мусорных» файлов (локальные артефакты/IDE).  
3) Обновлена документация (README/USAGE), если поведение поменялось.  

## Известные задачи (заполнить после анализа кода)
- [ ] Воспроизвести текущую поломку **local-clips-runner** и описать steps-to-repro.
- [ ] Добавить минимальные тесты регрессии.
- [ ] Улучшить логи и обработку ошибок.
